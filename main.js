(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{K0:()=>D,ri:()=>O,aT:()=>M,lM:()=>w,S1:()=>T,Vm:()=>B,rn:()=>P,u2:()=>g,p4:()=>x});var t,n=function(e){return e.some((function(e){return!e.validity.valid}))},r=document.querySelector(".popup_type_edit"),o=document.querySelector(".popup_type_add"),c=document.querySelector(".popup_type_image"),a=document.querySelector(".popup_type_delete"),i=document.querySelectorAll(".popup__close"),u=document.querySelector(".popup_type_avatar-edit"),l=document.querySelectorAll(".popup"),d=c.querySelector(".image"),s=c.querySelector(".popup__description");function f(e){e.classList.add("popup_opened"),t=e,document.addEventListener("keydown",v)}function m(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",v)}function v(e){"Escape"===e.key&&m(t)}var _={baseUrl:"https://nomoreparties.co/v1/plus-cohort-28",headers:{authorization:"587a6577-aa88-4458-9a8b-aaa868f62a49","Content-Type":"application/json"}};function p(e){if(null==e){var t=S("/users/me",_).then((function(e){return g.textContent=e.name,x.textContent=e.about,O.src=e.avatar,e})).catch(b);return t}g.textContent=e.name,x.textContent=e.about,O.src=e.avatar}function y(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function S(e,t){return fetch(t.baseUrl+e,t).then(y)}function b(e){return Promise.reject("Ошибка: ".concat(e))}var q=document.querySelector("#title"),h=document.querySelector("#link"),C=document.querySelector(".cards");function E(e){var t=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),n=t.querySelector(".card__image");return n.src=e.link,n.alt=e.name,t.id=e._id,t.querySelector(".card__caption").textContent=e.name,t.querySelector(".card__like").addEventListener("click",L),t.querySelector(".card__like-indicator").textContent=e.likes.length,t.querySelector(".card__button").addEventListener("click",(function(){return t=e,f(c),d.src=t.link,d.alt=t.name,void(s.textContent=t.name);var t})),t.querySelector(".card__delete").addEventListener("click",(function(){f(a),a.dataset.id=e._id})),M._id!==e.owner._id&&t.querySelector(".card__delete").remove(),e.likes.find((function(e){return e._id==M._id}))&&t.querySelector(".card__like").classList.add("card__like_active"),t}function L(e){e.target.classList.toggle("card__like_active");var t,n,r=e.target.nextElementSibling;e.target.classList.contains("card__like_active")?(t=e.target.offsetParent.id,n=_,_.method="PUT",S("/cards/likes/".concat(t),n)).then((function(e){r.textContent=Number(r.textContent)+1})).catch(b):function(e){var t=_;return _.method="DELETE",S("/cards/likes/".concat(e),t)}(e.target.offsetParent.id).then((function(e){r.textContent=Number(r.textContent)-1})).catch(b)}var k,g=document.querySelector(".profile__title"),x=document.querySelector(".profile__caption"),B=document.querySelector("#name"),P=document.querySelector("#profession"),T=document.querySelector(".profile__pencil"),A=document.querySelector("#avatar-link"),O=document.querySelector(".profile__avatar"),j=document.querySelector(".profile__overlay"),N=document.querySelector(".button-avatar-edit"),D=document.querySelector(".profile__button"),w=document.querySelector(".button__delete"),M=null;M=p(),S("/cards",_).then((function(e){e.forEach((function(e){var t=E(e);C.prepend(t)}))})).catch(b),document.querySelector("#add-card").addEventListener("submit",(function(e){var n,r,o;e.preventDefault(),(n=q.value,r=h.value,o=_,_.method="POST",_.body=JSON.stringify({name:n,link:r}),S("/cards",o)).then((function(e){D.value="Сохранение";var t=E(e);C.append(t)})).catch(b).finally((function(){q.value="",h.value="",m(t),e.submitter.classList.add("form__button_type_disabled"),e.submitter.disabled=!0,D.value="Сохранить"}))})),document.querySelector("#edit-profile").addEventListener("submit",(function(e){var n,r,o;e.preventDefault(),(n=B.value,r=P.value,o=_,_.method="PATCH",_.body=JSON.stringify({name:n,about:r}),S("/users/me",o)).then((function(){T.value="Сохранение",g.textContent=B.value,x.textContent=P.value})).catch(b).finally((function(){m(t),e.submitter.classList.add("form__button_type_disabled"),e.submitter.disabled=!0,T.value="Сохранить"}))})),i.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return m(t)}))})),l.forEach((function(e){e.addEventListener("click",(function(e){e.currentTarget===e.target&&m(t)}))})),N.addEventListener("click",(function(e){var n,r;(n=A.value,r=_,_.method="PATCH",_.body=JSON.stringify({avatar:n}),S("/users/me/avatar",r)).then((function(e){p(M=e)})).catch(b).finally((function(){m(t)}))})),w.addEventListener("click",(function(){var e;(function(e){var t=_;return _.method="DELETE",S("/cards/".concat(e),t)})(e=a.dataset.id).then((function(t){w.value="Удаление",document.getElementById("".concat(e)).remove()})).catch(b).finally((function(){m(t),w.value="Да"}))})),D.addEventListener("click",(function(){f(o)})),j.addEventListener("click",(function(){f(u)})),T.addEventListener("click",(function(){f(r),B.value=g.textContent,P.value=x.textContent})),k={formSelector:".form",inputSelector:".form__field",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_type_disabled",inputErrorClass:"form__field_type_error",errorClass:"form__field-error"},Array.from(document.querySelectorAll(k.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);r.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error")),o=e.querySelector(n.submitButtonSelector);t.classList.remove(n.inputErrorClass),r.classList.remove("".concat(n.errorClass,"_active")),o.classList.remove(n.inactiveButtonClass),o.disabled=!1,r.textContent=""}(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error")),c=e.querySelector(r.submitButtonSelector);t.classList.add(r.inputErrorClass),c.classList.add(r.inactiveButtonClass),c.disabled=!0,o.textContent=n,o.classList.add("".concat(r.errorClass,"_active"))}(e,t,t.validationMessage,n)}(e,c,t),function(e,t,r){n(e)?(t.classList.add(r.inactiveButtonClass),t.disabled=!0):(t.classList.remove(r.inactiveButtonClass),t.disabled=!1)}(r,o,t)}))}))}(e,k)}))})();